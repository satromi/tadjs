# TADjs Desktop ユーザーマニュアル

Ver0.29

## 目次
1. [TADjs Desktopについて](#tadjs-desktopについて)
2. [起動方法](#起動方法)
3. [基本的な使い方](#基本的な使い方)
4. [仮身と実身の概念](#仮身と実身の概念)
5. [プラグイン一覧](#プラグイン一覧)
6. [ファイル操作](#ファイル操作)
7. [よくある質問](#よくある質問)

---

## TADjs Desktopについて

TADjs Desktopは、BTRON（Business TRON）のTAD（Text And Draw）形式ファイルを扱うためのデスクトップ環境です。テキストと図形を統合的に扱える文書システムを、モダンなElectronベースのアプリケーションとして実現しています。

### 主な機能
- **TAD形式ファイルの表示・編集**: テキストと図形を含む文書の作成・編集
- **仮身・実身システム**: BTRONの仮想オブジェクト管理を再現
- **プラグインシステム**: 拡張可能なアプリケーション構造
- **書庫（BPK）ファイル対応**: 複数ファイルを含むアーカイブ形式に対応

### サポートファイル形式
- `.tad`, `.TAD`: 標準的なTAD文書ファイル
- `.bpk`, `.BPK`: 複数ファイルを含むアーカイブ形式（LH5圧縮対応）
- `.xtad`, `.XTAD`: 拡張TAD形式

---

## 起動方法

### Windows
1. zipファイルをどこかのフォルダに解凍して、`tadjs_desktop.exe`を実行します
2. アプリケーションが起動し、デスクトップ環境が表示されます


---

## 基本的な使い方

### デスクトップ環境

TADjs Desktopは、BTRONデスクトップ環境を提供します。

#### 画面構成
- **デスクトップ領域**: ウィンドウが表示される作業エリア
- **ステータスバー**: 画面下部にシステムメッセージと時刻を表示
- **メニューバー**: 画面上部にマウスを移動すると自動表示

#### メニューバーの表示
- 画面上部（上端から10px以内）にマウスカーソルを移動すると、メニューバーが自動的に表示されます
- メニューバーから離れると自動的に非表示になります

#### メニュー項目
- **View**
  - **Toggle Developer Tools** (Ctrl+Shift+I): 開発者ツールの表示/非表示
  - **Reload** (Ctrl+R): アプリケーションの再読み込み
  - **Toggle Full Screen** (F11): 全画面表示の切り替え

### ウィンドウ操作

#### ウィンドウの基本操作
- **移動**: タイトルバーをドラッグ
- **リサイズ**: ウィンドウの端や角をドラッグ（リサイズ可能なウィンドウのみ）
- **最大化/復元**: タイトルバーの最大化ボタンをクリック
- **閉じる**: タイトルバーの×ボタンをクリック

#### ウィンドウの状態
- **アクティブウィンドウ**: 最前面に表示され、操作対象となるウィンドウ
- **背景化**: 他のウィンドウの背後に配置（編集不可）
- **最小化**: タスクバーに格納（未実装）

#### スクロール操作
- スクロール可能なウィンドウには、カスタムスクロールバーが表示されます
- マウスホイール、またはスクロールバーのドラッグで操作できます

### 右クリックメニュー

デスクトップやファイルを右クリックすると、コンテキストメニューが表示されます。
- **開く**: ファイルをデフォルトのプラグインで開く
- **プロパティ**: ファイルの詳細情報を表示

---

## 仮身と実身の概念

TADjs Desktopは、BTRONの「仮身」「実身」という独特のファイル管理概念を採用しています。

### 実身（Real Object）
- **実体ファイル**: 実際のデータを持つファイル
- **一意のID**: UUIDv7で管理される固有識別子
- **参照カウント**: その実身を参照している仮身の数を記録
- **ファイル構成**:
  - `.json`: メタデータ（名前、プラグインID、参照カウントなど）
  - `_0.xtad`: 実際のデータ（TAD形式）
  - `.ico`: アイコン画像

### 仮身（Virtual Object）
- **参照オブジェクト**: 実身へのリンク（参照）
- **複数配置可能**: 同じ実身に対して複数の仮身を作成可能
- **属性情報**: 表示位置、サイズ、表示設定などを保持

### 仮身と実身の関係
```
原紙箱（実身）
  └─ ファイルA.json
  └─ ファイルA_0.xtad
  └─ ファイルA.ico

文書1（実身）
  └─ <link>タグで「ファイルA」を参照（仮身1）

文書2（実身）
  └─ <link>タグで「ファイルA」を参照（仮身2）
```

上記の例では、「ファイルA」の実身に対して、2つの仮身が存在します。
- どちらの仮身からも同じ「ファイルA」の内容にアクセスできます
- 「ファイルA」の内容を更新すると、両方の仮身に反映されます
- 「ファイルA」の参照カウントは2になります

### 屑実身（Trash Real Objects）
- **参照カウントが0の実身**: どの仮身からも参照されていない実身
- **削除候補**: 「屑実身操作」プラグインで一覧表示・削除できます

---

## プラグイン一覧

TADjs Desktopは、プラグインシステムにより機能を拡張できます。

### 1. 原紙箱（Base File Manager）

**プラグインID**: `base-file-manager`
**アイコン**: 📑
**説明**: 原紙ファイル（実身）を管理し、仮身形式で一覧表示します

#### 起動方法
- デスクトップ起動時に自動的に表示されます
- 仮身一覧のxtadファイルを右クリック → 「原紙箱」を選択

#### 機能
- **原紙アプリの原紙の一覧表示**: 登録されている原紙アプリの原紙を表示
- **登録したユーザ原紙の一覧表示**: 原紙箱の仮身一覧実身に配置したユーザ原紙（テンプレート）を表示
- **仮身の配置**: 実身をドラッグして他のウィンドウに配置
- **プロパティ表示**: 実身の詳細情報を確認
- **検索**: 名前でファイルを検索

#### 操作方法
1. **原紙箱の実身を開く**: 原紙箱の仮身をダブルクリック
2. **原紙から実身を新規作成**: 原紙箱ウインドウ内の原紙を他のウィンドウにドラッグ＆ドロップ
3. **右クリックメニュー**:
   - **開く**: 実身をデフォルトのプラグインで開く
   - **プロパティ**: 実身の詳細情報を表示
4. **ユーザ原紙の配置**:
   - **開く**: 原紙箱の仮身について右クリックメニュー実行から仮身一覧プラグインを選択して開く
   - **ユーザ原紙配置**: テンプレートにしたい実身を原紙箱の実身にユーザ原紙として配置

### 2. 仮身一覧（Virtual Object List）

**プラグインID**: `virtual-object-list`
**アイコン**: 📋
**説明**: TADファイル内の仮身（リンク）を一覧表示します

#### 起動方法
- TAD/BPK/XTADファイルを右クリック → 「仮身一覧」を選択

#### 機能
- **仮身の一覧表示**: 文書内の全ての仮身をリスト表示
- **仮身の開閉**: 仮身をクリックして展開/折りたたみ
- **内容プレビュー**: 仮身の内容をその場で表示
- **ドラッグ＆ドロップ**: 仮身を他のウィンドウに移動

#### 表示モード
- **閉じた仮身**: アイコンと名前のみ表示
- **開いた仮身**: 内容を展開して表示（読み取り専用）

#### 操作方法
1. **仮身を開く**: 閉じた仮身をクリック → 内容が展開表示される
2. **仮身を閉じる**: 開いた仮身のタイトルバーをクリック
3. **仮身を削除**: 仮身を右クリック → 削除（未実装）

### 3. 基本文章編集（Basic Text Editor）

**プラグインID**: `basic-text-editor`
**アイコン**: 📋
**説明**: TADファイル用リッチテキストエディタ

#### 起動方法
- TAD/BPK/XTADファイルを右クリック → 「基本文章編集」を選択

#### 機能
- **リッチテキスト編集**: 書体、サイズ、色などの設定
- **文字修飾**: 太字、斜体、下線、取り消し線など
- **ルビ（ふりがな）**: 文字の上下にルビを追加
- **画像挿入**: 画像をドラッグ＆ドロップで挿入
- **仮身挿入**: 他のファイルへのリンクを挿入
- **2つの表示モード**: 清書モードと原稿（XML）モード

#### メニュー構成

##### 保存
- ファイルの変更を保存

##### 表示
- **原稿（xml直接表示）モード**: XMLソースを直接表示・編集
- **清書モード**: 整形されたリッチテキストを表示
- **全画面表示オンオフ** (Ctrl+L): 全画面表示の切り替え
- **再表示**: 画面を再描画
- **背景色変更**: エディタの背景色を変更
- **ウインドウ幅で折り返し**: テキストの折り返しを切り替え

##### 編集
- **取消**: 直前の操作を取り消し
- **クリップボードへコピー** (Ctrl+C): 選択テキストをコピー
- **クリップボードからコピー** (Ctrl+V): クリップボードから貼り付け
- **クリップボードへ移動** (Ctrl+X): 選択テキストを切り取り
- **クリップボードから移動** (Ctrl+Z): やり直し
- **すべて選択**: 文書全体を選択
- **検索/置換**: テキストの検索と置換

##### 書体
- **書体一覧**: 利用可能なフォントを表示
- **ゴシック**: ゴシック体に変更
- **明朝**: 明朝体に変更
- **メイリオ**: メイリオに変更

##### 文字修飾
- **標準**: 修飾を解除
- **太字** (Ctrl+B): 太字に変更
- **斜体**: 斜体に変更
- **袋文字**: 文字を袋文字（縁取り）に
- **枠囲み**: 文字を枠で囲む
- **影付き**: 文字に影を付ける
- **下線**: 下線を引く
- **上線**: 上線を引く
- **取り消し線**: 取り消し線を引く
- **網掛**: 文字を網掛けに
- **反転**: 文字色と背景色を反転
- **無印字**: 文字を薄く表示（印刷時に無視）
- **上付き**: 上付き文字（例：x²）
- **下付き**: 下付き文字（例：H₂O）
- **解除**: 全ての修飾を解除

##### 文字サイズ
- 5pt（1/2倍）～ 77pt（8倍）まで選択可能
- **数値指定**: 任意のサイズを入力
- **全角/半角**: 文字幅の変更

##### 文字色
- **基本色**: 黒、青、赤、ピンク、橙、緑、黄緑、水色、黄、白
- **文字色指定（RGB）**: 16進数カラーコードで指定（例：FFFFFF）

##### 書式
- **字下げ**: 段落の字下げを設定
- **行揃え**:
  - **行頭揃え**: 左揃え
  - **中央揃え**: 中央揃え
  - **行末揃え**: 右揃え
- **ルビ**:
  - **ルビ（上）**: 文字の上側にふりがなを追加
  - **ルビ（下）**: 文字の下側にふりがなを追加
- **改ページ**: 改ページを挿入

#### 操作方法

##### テキスト編集
1. **文字入力**: 通常通りキーボードで入力
2. **改行**: Enterキーで改段落
3. **書式設定**: テキストを選択 → メニューから書式を選択

##### ルビの挿入
1. ルビを付ける文字列を選択
2. メニュー → 書式 → ルビ → ルビ（上）または（下）
3. ダイアログにルビテキストを入力
4. OKをクリック

##### 画像の挿入
1. 画像ファイルをエディタにドラッグ＆ドロップ
2. 画像が挿入される
3. 画像をクリックして選択 → 角をドラッグしてリサイズ

##### 仮身の挿入
1. 原紙箱から仮身をドラッグ
2. エディタにドロップ
3. 仮身リンクが挿入される

##### 保存
- メニュー → 保存
- または、ウィンドウを閉じる際に保存確認ダイアログが表示される

#### キーボードショートカット
- **Ctrl+B**: 太字
- **Ctrl+C**: コピー
- **Ctrl+V**: 貼り付け
- **Ctrl+X**: 切り取り
- **Ctrl+Z**: やり直し
- **Ctrl+L**: 全画面表示切り替え
- **Enter**: 改段落
- **Shift+Enter**: 行内改行（未実装）

### 4. 基本図形編集（Basic Figure Editor）

**プラグインID**: `basic-figure-editor`
**アイコン**: 🎨
**説明**: 図形を描画・編集するプラグイン

#### 起動方法
- TAD/BPK/XTADファイルを右クリック → 「基本図形編集」を選択

#### 機能
- **図形描画**: 線、矩形、楕円、多角形などを描画
- **図形編集**: 図形の移動、リサイズ、回転
- **属性設定**: 線の色、太さ、塗りつぶし色などを設定
- **レイヤー管理**: 図形の重なり順を変更

#### ツールバー
- **選択ツール**: 図形を選択・移動
- **線ツール**: 直線を描画
- **矩形ツール**: 矩形を描画
- **楕円ツール**: 楕円を描画
- **多角形ツール**: 多角形を描画（未実装）
- **テキストツール**: テキストを挿入（未実装）

#### 操作方法

##### 図形の描画
1. ツールバーから描画ツールを選択
2. キャンバス上でドラッグして図形を描画
3. マウスを離すと図形が確定

##### 図形の選択と移動
1. 選択ツールをクリック
2. 図形をクリックして選択
3. ドラッグして移動

##### 図形のリサイズ
1. 図形を選択
2. 四隅のハンドルをドラッグ

##### 図形の削除
1. 図形を選択
2. Deleteキーを押す

##### 属性の変更
1. 図形を選択
2. プロパティパネルで色や線の太さを変更

##### 保存
- メニュー → 保存
- または、ウィンドウを閉じる際に保存確認

### 5. TADjs表示（TADjs View）

**プラグインID**: `tadjs-view`
**アイコン**: 📄
**説明**: TADファイルとBPKファイルを読み取り専用で表示します

#### 起動方法
- TAD/BPK/XTADファイルを右クリック → 「TADjs表示」を選択

#### 機能
- **読み取り専用表示**: TAD文書を表示のみ（編集不可）
- **仮身のクリック**: 仮身をクリックして実身を開く
- **高速表示**: 編集機能がないため高速に表示

#### 操作方法
1. ファイルを開くと内容が表示される
2. 仮身をクリックするとリンク先が開く
3. スクロールして文書を閲覧

### 6. 書庫解凍（Unpack File）

**プラグインID**: `unpack-file`
**アイコン**: 📦
**説明**: BPK書庫ファイルを解凍し、実身ファイルを生成します

#### 起動方法
- BPKファイルを右クリック → 「書庫解凍」を選択

#### 機能
- **BPK解凍**: 書庫ファイルから実身を展開
- **実身生成**: 解凍したファイルから実身（JSON、XTAD、ICO）を生成
- **自動登録**: 展開した実身を原紙箱に自動登録

#### 操作方法
1. BPKファイルを右クリック → 「書庫解凍」
2. 「展開」ボタンをクリック
3. 展開処理が実行される
4. 完了すると原紙箱に実身が追加される

### 7. 屑実身操作（Trash Real Objects）

**プラグインID**: `trash-real-objects`
**アイコン**: 🗑️
**説明**: 参照カウントが0の屑実身を一覧表示・管理します

#### 起動方法
- メニューから「屑実身操作」を選択（要実装）
- または、システム環境設定から起動

#### 機能
- **屑実身の一覧**: 参照カウント=0の実身を表示
- **削除**: 不要な屑実身を削除してディスク容量を回復
- **復元**: 誤って削除した実身を復元（未実装）

#### 操作方法
1. 屑実身一覧が表示される
2. 削除する屑実身をチェック
3. 「削除」ボタンをクリック
4. 確認ダイアログで「OK」

### 8. システム環境設定（System Config）

**プラグインID**: `system-config`
**アイコン**: ⚙️
**説明**: システム全体の環境設定を行います

#### 起動方法
- メニューから「システム環境設定」を選択（要実装）

#### 機能
- **表示設定**: デスクトップの背景色、フォントなど
- **動作設定**: ウィンドウの動作、スクロール速度など
- **プラグイン管理**: プラグインの有効/無効を切り替え

#### 操作方法
1. 設定項目を選択
2. 値を変更
3. 「適用」または「OK」をクリック

---

## ファイル操作

### ファイルを開く

#### 方法1: デスクトップから
1. 原紙箱から仮身をダブルクリック
2. デフォルトのプラグインでファイルが開く

#### 方法2: 右クリックメニュー
1. 仮身を右クリック
2. メニューから「開く」または特定のプラグイン名を選択
3. 選択したプラグインでファイルが開く

#### 方法3: ドラッグ＆ドロップ
1. 外部からファイルをデスクトップにドラッグ
2. ファイルダイアログが表示される（未実装）

### ファイルを保存

#### 自動保存
- 編集中のファイルは、定期的に自動保存されます（未実装）

#### 手動保存
1. メニュー → 保存
2. または、ウィンドウを閉じる際に保存確認ダイアログが表示される

### ファイルの名前変更

1. 仮身を右クリック → プロパティ
2. 名前欄を編集
3. 「OK」をクリック（未実装）

### ファイルの削除

#### 仮身の削除
1. 仮身を選択
2. Deleteキーを押す
3. 仮身が削除される（実身は残る）

#### 実身の削除
1. 参照カウントが0になるまで全ての仮身を削除
2. 「屑実身操作」プラグインで実身を削除

---

## よくある質問

### Q1. ファイルが開けません
**A**: 以下を確認してください：
- ファイル形式がサポートされているか（.tad, .bpk, .xtad）
- ファイルが破損していないか
- 適切なプラグインがインストールされているか

### Q2. 編集した内容が保存されません
**A**:
- ウィンドウを閉じる前に「保存」を実行してください
- 保存確認ダイアログで「保存」を選択してください
- ファイルの書き込み権限があるか確認してください

### Q3. 仮身と実身の違いは何ですか？
**A**:
- **実身**: 実際のデータを持つファイル（実体）
- **仮身**: 実身へのリンク（参照）
- 同じ実身に対して複数の仮身を作成できます

### Q4. 屑実身とは何ですか？
**A**:
- どの仮身からも参照されていない実身（参照カウント=0）
- 削除しても他のファイルに影響しない
- 「屑実身操作」プラグインで管理できます

### Q5. ルビ（ふりがな）が正しく表示されません
**A**:
- ルビを付ける文字列を正しく選択していますか？
- ルビテキストを正しく入力しましたか？
- ブラウザがRubyタグをサポートしているか確認してください

### Q6. 画像が表示されません
**A**:
- 画像ファイルが同じディレクトリにあるか確認してください
- サポートされている画像形式か確認してください（PNG, JPEG, GIF, SVG）
- ファイルパスが正しいか確認してください

### Q7. メニューバーが表示されません
**A**:
- マウスカーソルを画面上端に移動してください
- 自動的にメニューバーが表示されます

### Q8. ウィンドウが画面外に出てしまいました
**A**:
- タイトルバーをドラッグして画面内に移動してください
- または、アプリを再起動してください

### Q9. プラグインを追加するには？
**A**:
- `plugins`ディレクトリに新しいプラグインフォルダを配置
- `plugin.json`を正しく設定
- アプリを再起動

### Q10. BPKファイルを作成するには？
**A**:
- 現在、BPKファイルの作成機能は未実装です
- 既存のBPKファイルの解凍のみ対応しています

---

## トラブルシューティング

### アプリが起動しない
1. Electronがインストールされているか確認
2. `npm install`を実行して依存関係をインストール
3. `npm start`で起動を試す
4. エラーメッセージを確認

### ファイルが読み込めない
1. ファイル形式が正しいか確認
2. ファイルが破損していないか確認
3. 開発者ツール（Ctrl+Shift+I）でエラーを確認

### 保存できない
1. ファイルの書き込み権限を確認
2. ディスク容量を確認
3. ファイルパスに問題がないか確認

### 動作が遅い
1. 開いているウィンドウを減らす
2. 大きなファイルを閉じる
3. アプリを再起動

---

## 技術情報

### システム要件
- **OS**: Windows 10/11 (64bit)
- **メモリ**: 4GB以上推奨
- **ディスク**: 100MB以上の空き容量

### 使用技術
- **Electron**: デスクトップアプリケーションフレームワーク
- **HTML5/CSS3**: UI
- **JavaScript (ES6+)**: アプリケーションロジック
- **Canvas API**: 図形描画

### ファイル構造
```
TADjs Desktop/
├── electron/
│   ├── main.js          # Electronメインプロセス
│   ├── preload.js       # プリロードスクリプト
│   └── plugin-manager.js # プラグイン管理
├── plugins/             # プラグインディレクトリ
│   ├── basic-text-editor/
│   ├── basic-figure-editor/
│   ├── virtual-object-list/
│   └── ...
├── tad_data/            # データディレクトリ
├── tadjs-desktop.html   # メインHTML
├── tadjs-desktop.js     # メインロジック
├── tadjs-desktop.css    # メインスタイル
└── tad.js               # TADファイル処理ライブラリ
```

---

## 更新履歴

### Version 1.0.0 (2025-01-XX)
- 初版リリース
- 基本的な文章編集機能
- 図形編集機能
- 仮身・実身システム
- プラグインシステム

---

## ライセンス

MIT License

Copyright (c) 2025 satromi

---

## お問い合わせ

- GitHub: https://github.com/satromi/tadjs
- Issues: https://github.com/satromi/tadjs/issues

---

## 謝辞

このプロジェクトは、BTRONの仮身・実身システムの概念を基にしています。

---

**TADjs Desktop User Manual**
Version 1.0.0
最終更新: 2025年1月
