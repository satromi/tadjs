# TADjs

[TADjs Desktop Ver0.32](https://github.com/satromi/tadjs/releases/tag/Ver0.32 "TADjs Desktop Ver0.32 Release")

satromi@gmai.com

## 紹介

BTRONはファイルシステムから実身/仮身という形でハイパーテキストを活用でき、さらにTADというデータフォーマットを用いることで文章/画像といったデータを混在できるように統一できるようにしたのが特徴です。

TADjsはBTRONユーザが継続的に実身/仮身、TADを活用していくために、ブラウザ上でBTRONの特徴である実身仮身構造を再現して、BTRONの文章/画像ファイルであるTADの表示・編集が可能なツールを目指しています。

## 使い方（今のところの）

お使いのコンピュータのどこかのフォルダにファイル（index.html, tad.js, lh5.js, ./lib/encoding.min.js）を配置してください。

ブラウザでindex.htmlを開いて「ファイル選択」ボタンを押下してTADファイルを選択すると、TAD文章/画像ファイルが表示できます。

※TADファイルを描画領域にドラッグアンドドロップしても同様に動作します。

書庫形式で複数TADファイルが圧縮されている場合、タブ切り替えで複数のTADを表示できます。表示領域上部の「Tab N」ボタンを押下してください。

タブ一覧がページの横幅で収まらない場合、スクロールボタンが左右に表示されます。また、タブボタンをドラッグするとスクロールできます。

※デフォルト表示は（Tab 1）

書庫形式である実身内に仮身セグメントがある場合、仮身をクリックするとリンク先の実身に飛ぶことができます。

## 更新履歴

### Ver0.01

単一ファイル、無変換のTADの表示に対応しました。

### Ver0.02

書庫形式(bpk)のTAD（ただし1ファイルのみ）解凍、表示に対応しました。

### Ver0.03

書庫形式(bpk)のTADで複数ファイル表示に対応しました。

### Ver0.04

書庫形式(bpk)のTADでリンクレコード、仮身セグメント（仮身表示）に対応しました。

### Ver0.05

HTMLのデザインを変更して、10タブ以上ある場合にもスクロールできるようにしました。

### Ver0.06

データの読込が遅かったのを改善しました。

### Ver0.07

開いた仮身に対応しました。また、レイアウトの不具合に対応しました。

### Ver0.08

図形TADのカラーマップ、マスクデータ定義に一部対応しました。まだ不具合があります。

### Ver0.09

文章TADでルビ（開始指定付箋、終了指定付箋）、文章メモ指定付箋、変数参照指定付箋（ID）に対応しました。フォント指定付箋、行頭禁則（開始指定付箋、終了指定付箋）、行末禁則（開始指定付箋、終了指定付箋）、固定幅空白指定付箋に簡易的に対応しました。

図形TADで扇形セグメント、弓形セグメント、図形要素修飾セグメント、図形メモ指定付箋に対応しました。

### Ver0.10

細かな不具合を修正しました。

### Ver0.11

開いた仮身の表示不具合を修正しました。

### Ver0.12

行頭禁則の不具合を修正しました。

### Ver0.13

TADjs Desktopとして公開しました。

### Ver0.14

TADjs Desktopのもろもろの不具合を修正しました。

### Ver0.15

TADjs Desktopで実身/仮身の複製が上手く動作しない不具合、基本文章編集プラグインで文字・仮身配置のベースラインがおかしかった不具合などを修正しました。

### Ver0.16

基本文章編集プラグインでの実身複製、仮身移動（の際の仮身属性の保持）などに不具合があったので修正しました。

### Ver0.17

実身配置フォルダをユーザ環境設定で設定できるように機能追加しました。これに伴い、tadjs-desktop.js内部の実身読込時ファイルパス指定も機能追加しました。

基本文章編集プラグインで、字下げ、タブの保存・表示に不具合があったので修正しました。

基本図形編集プラグインで、仮身の表示、実身複製後の保存処理に不具合があったので修正しました。ただし、仮身の表示順が画像・図形より前面になる不具合は残っています。

tadjs-desktop.jsと基本文章編集プラグイン、基本図形編集プラグイン、仮身一覧プラグインのリファクタリングを実施しました。

### Ver0.18

基本表計算プラグインを作成しました。
基本表計算のデータを書庫形式で読み込むと、データについては取り込めるようになりました。

ただし、基本表計算のデータはTAD補助レコードがTAD主レコードより前のレコードにありますが、仕様が分からず内容が不明なので解釈していません。
また、TAD主レコードは、文章TADの中に、指定付箋セグメント（で基本表計算のセル位置、セル修飾などを指定）→タブ区切り記法での表計算データ記載→指定付箋セグメント（で基本表計算のセル位置、セル修飾などを指定）→タブ区切り記法での表計算データ記載という繰り返しになっていますが、指定付箋セグメントの記載内容がセル位置以外にまだ解析できていないので、セル修飾などは全て反映されません。

### Ver0.19

- 基本表計算プラグインの下記の不具合を修正しました。
  - 行・列のセルサイズを変更した場合に正しく描画されないのを修正
  - 枠線をセルだけに引けない不具合を修正
  - 文字修飾状態、枠線色状態の不具合を修正
  - セルの範囲選択、セル指定の不具合を修正
  - 仮身のドラッグ元が仮身一覧プラグインにしか対応していなかったので、他のプラグインからもドラッグできるように修正
- 各プラグインの仮身操作を共通化し下記の不具合を修正しました。
  - 仮身コピー（右クリックドラッグ）後、通常の仮身移動のドラッグアンドドロップをしても仮身コピーされる不具合を修正
  - 実身管理用セグメントで参照カウント（refCount）を正しく計算できていなかったので修正
-基本文章編集プラグインの機能を追加しました。
  - 編集の検索/置換機能を子ウインドウの機能として追加
  - 右クリックメニュー、編集に仮身化（Ctrl+9）を追加
- 基本図形編集プラグインの下記の不具合を修正しました。
  - 仮身ドラッグ時、まれに仮身がコピーされてしまう不具合を修正

### Ver0.20

- 書庫解凍プラグインの下記の不具合を修正しました。
  - TAD主レコード以外のレコードがある際にxmlTAD出力処理をキャンセルする処理に不具合があったので修正

### Ver0.21

- 原紙箱プラグインの機能を追加しました。
  - ユーザ原紙を配置できる機能を追加
- 基本文章編集プラグインの機能を追加しました。
  - ウインドウ幅で折り返しする表示のオンオフする機能を追加
  - 開いた仮身でもウインドウ幅で折り返しのオンオフに従って表示する機能を追加
- 基本表計算プラグインの機能を追加しました。
  - 開いた仮身表示する機能を追加
  - セル内の表示位置の上中下と設定できる機能を追加
- 各プラグインで開いた仮身のスクロール位置に従って表示する機能を追加しました。
- 諸々の不具合を修正しました。
  - 基本図形編集プラグインと基本文章編集プラグイン、基本表計算プラグインで、仮身の仮身属性で自動起動が機能しない不具合を修正
  - 仮身一覧プラグインで仮身コピーした場合の表示位置、仮身属性が変わる不具合を修正
- 基本図形編集プラグインの下記の不具合を修正しました。
  - 仮身属性変更の機能を使って仮身の背景色を変更できない不具合を修正
  - ポリゴン（多角形）だと多角形の枠線に沿って選択枠が表示されない不具合を修正
- 基本表計算プラグインの下記の不具合を修正しました。
  - 実親名称入力ダイアログで文字が入力できない不具合を修正
  - 原紙からドラッグできない不具合を修正
  - 仮身のサイズ、仮身属性がが保存されない不具合を修正
  - 実身名称変更、実身複製できない不具合を修正
  - 仮身選択で選択できない不具合を修正

### Ver0.22

- 仮身ネットワークプラグインを追加しました。
  - 仮身ネットワークを表示する機能を追加
- 実身/仮身検索プラグインを追加しました。
  - 仮身ネットワークに基づいて検索する機能を追加
  - [注意]正規表現は正しく動作しない可能性が高いです
- 基本文章編集プラグインの機能を追加しました。
  - 画像を配置する機能を追加
- 基本表計算プラグインの機能を追加しました。
  - セルに画像を配置する機能を追加
- 仮身ネットワーク機能を追加しました。
- 基本文章編集プラグインの下記の不具合を修正しました。
  - 編集でクリップボード操作しても更新フラグが記録されない不具合を修正
  - 実身複製が機能しない不具合を修正
- 基本図形編集プラグインの下記の不具合を修正しました。
  - 右クリックメニュー編集のクリップボード関連がうまく機能しない不具合を修正
  - 実身複製が機能しない不具合を修正
  - 実身名変更時に仮身表示がおかしくなる不具合を修正
- 基本表計算プラグインの下記の不具合を修正しました。
  - 複数ウインドウ開いている際、別のウインドウにフォーカスしていても基本表計算プラグインにカーソルがフォーカスされてしまい、カーソルが移動できない不具合を修正
  - 右クリックメニュー編集のクリップボード関連がうまく機能しない不具合を修正
- 諸々の不具合を修正しました。
  - ラジオボタンの見た目を修正

### Ver0.23

- 基本文章編集プラグインの下記の不具合を修正しました。
  - 文字列のコピーアンドペースト、クリップボード操作ができなくなる不具合を修正（どのバージョンからかは不明だがデグレ）
- 仮身ネットワークプラグインの下記の不具合を修正しました。
  - 仮身ネットワークで仮身のピクトグラムアイコンが表示されない不具合を修正

### Ver0.24

- 実身/仮身検索プラグインの下記の不具合を修正しました。
  - スクロールがうまく機能しない不具合を修正
- 基本文章編集プラグインの下記の不具合を修正しました。
  - 画像のコピーアンドペースト関連の不具合を修正
  - テキストのコピーアンドペースト関連の不具合を修正
  - コピーアンドペーストのショートカットの不具合を修正
- 基本図形編集プラグインの下記の不具合を修正しました。
  - 右クリックメニュー編集のクリップボード関連がうまく機能しない不具合を修正
  - クリップボード関連のショートカットキーが機能しない不具合を修正
  - 画像のコピーアンドペースト関連の不具合を修正
- 基本表計算プラグインの下記の不具合を修正しました。
  - 画像のコピーアンドペースト関連の不具合を修正

### Ver0.25

- 基本属性変更で文字色をカラーピッカーで選択する機能を追加しました。
- 続柄（リレーションタグ名）を設定・表示する機能を追加しました。
  - 続柄（リレーションタグ名）を設定・表示する機能を追加
- 基本文章編集プラグインの機能を追加しました。
  - 文字色をカラーピッカーで選択できる機能を追加
- 諸々の不具合を修正しました。
  - 右クリックメニュー表示、背景色変更機能の不具合を修正
- 仮身一覧プラグインの下記の不具合を修正しました。
  - 仮身属性変更の機能で仮身表示項目変更した場合の不具合を修正
- 基本文章編集プラグインの下記の不具合を修正しました。
  - ウインドウ切替時にカーソル位置がリセットされる不具合を修正
  - スクロールバーの不具合を修正
  - 仮身属性変更の機能で仮身表示項目変更した場合の不具合を修正
- 基本図形編集プラグインの下記の不具合を修正しました。
  - 仮身属性変更の機能で仮身表示項目変更した場合の不具合を修正
基本表計算プラグインの下記の不具合を修正しました。
  - 仮身属性変更の機能で仮身表示項目変更した場合の不具合を修正
  - スクロールバーの不具合を修正

### Ver0.26

- 諸々の不具合を修正しました。
  - スクロールバー処理全体に影響する不具合を修正
- 仮身一覧プラグインの下記の不具合を修正しました。
  - スクロールバーの不具合を修正
- 基本文章編集プラグインの下記の不具合を修正しました。
  - スクロールバーの不具合を修正
- 基本図形編集プラグインの下記の不具合を修正しました。
  - スクロールバーの不具合を修正
- 基本表計算プラグインの下記の不具合を修正しました。
  - 全画面表示オンオフがCtrl+Lに割り当たっていない不具合を修正
  - セル入力可能範囲がZ100までになっていた不具合を修正
- 原紙箱プラグインの下記の不具合を修正しました。
  - スクロールバーの不具合を修正
- 実身/仮身検索プラグインの下記の不具合を修正しました。
  - スクロールバーの不具合を修正
- 仮身ネットワークプラグインの下記の不具合を修正しました。
  - スクロールバーの不具合を修正

### Ver0.27

- ファイル取込の不具合を修正しました。
  - ファイル取込でファイルが取り込めない不具合を修正

### Ver0.28

- 管理情報プラグインを追加しました。
  - 実身の管理情報セグメントjsonを参照、編集できる機能を追加
- 実身仮身検索プラグインの機能を追加しました。
  - "続柄"を検索できる機能を追加
- 基本図形編集プラグインの下記の不具合を修正しました。
  - キャンバス機能のポップアップを修正
  - キャンバス機能の描画を修正
  - キャンバス機能の保存を修正
- システム環境設定の見た目を修正しました。
  - スクロールバーをTADjs Desktop標準に修正
- ユーザ環境設定の見た目を修正しました。
  - スクロールバーをTADjs Desktop標準に修正

### Ver0.29

- 基本表計算プラグインの機能を追加しました。
  - 棒グラフ、折れ線グラフを作成する機能（プレリリース）を追加
- 実身仮身検索プラグインの機能を追加しました。
- 諸々の不具合を修正しました。
  - 全画面表示オンオフでスクロールバーがウインドウサイズから突き抜ける不具合を修正
  - 右クリックメニュー呼び出しに関する不具合を修正
- 基本文章編集プラグインの下記の不具合を修正しました。
  - 実身名変更した後に、仮身属性が正しく表示されない不具合を修正
- 基本表計算プラグインの下記の不具合を修正しました。
  - ウインドウ全画面表示オンオフの不具合を修正
- 基本表計算プラグインの下記の不具合を修正しました。
  - キャンバス機能（ビットマップ編集機能）の不具合を修正
- TADjs Viewプラグインの下記の不具合を修正しました。
  - スクロールバーが動作しない不具合を修正
  - Ctrl+Lが機能しない不具合を修正

### Ver0.30

- 予定表プラグインを追加しました。
  - 予定表実身を生成する機能を追加
  - 予定表実身に日毎実身を配置する機能を追加
- 基本文章編集プラグインの機能を追加しました。
  - 用紙サイズ設定する機能（まだ設定だけ）を追加
- 基本図形編集プラグインの機能を追加しました。
  - 折れ線セグメントを描画する機能を追加
  - 三角形を描画しやすいボタンを追加
  - 用紙サイズ設定する機能（まだ設定だけ）を追加
- 基本表計算プラグインの機能を追加しました。
  - グラフをコピーアンドペーストする機能を追加
  - グラフを図形編集プラグインで操作できるようなグループ化した図形セグメントとして描画する機能を追加
  - 用紙サイズ設定する機能（まだ設定だけ）を追加
- 基本文章編集プラグインの下記の不具合を修正しました。
  - 仮身属性変更時に仮身サイズが変わる不具合を修正
  - 既存の図形を選択した際に操作パネルに反映されない不具合を修正
- 基本図形編集プラグインの下記の不具合を修正しました。
  - 線種タイプがTAD定義と違っていたのを修正

### Ver0.31

- 予定表プラグインの機能を追加しました。
  - 仮身を自由に配置、開いた仮身表示する機能を追加
  - 予定表実身に"休日"実身がある場合、カレンダーで休日表示する機能を追加

### Ver0.32

- 諸々の機能を追加しました。
  - 続柄設定機能で、続柄を仮身ごとに持たせるか、実身に持たせるか管理できるような機能を追加
  - ブラウザからURLをドラッグすると、URL仮身の実身を作成する機能を追加
- 諸々の不具合を修正しました。
  - 実身名変更時、全ての仮身に変更後の実身名が反映されない不具合を修正
- 仮身一覧プラグインの下記の不具合を修正しました。
  - 背景色変更時、ウインドウサイズより外側まで背景色が反映されない不具合を修正
- 基本文章編集プラグインの下記の不具合を修正しました。
  - TADを変換したファイルで改段落後にフォント等セグメントの効果が継続しない不具合を修正
  - 文字サイズ変更後の改段落時に改段落幅が正しく反映されない不具合を修正
  - 仮身名変更時の仮身サイズが足りなかった不具合を修正
  - 改行時、改行削除時の不具合を修正
- 仮身一覧プラグインの下記の不具合を修正しました。
  - 仮身移動、削除時の再描画処理を修正
- 書庫解凍プラグインの下記の不具合を修正しました。
  - 実身の1段落目で変換に失敗する不具合を修正

## 【既知のバグ】TADjs（TADjs Desktopではなく）

- 全般
  - 複数ページ表示している場合に、スクロールバーが1タブ目にだけ表示されてしまう。
  - リロードしないと新たなファイルを開けない場合がある。
- 文章TAD
  - 文字描写のベースラインが上側指定になっているので行中でフォントサイズを変えると上に表示される
  - 折り返し位置がハードコーディングでウインドウサイズを変えても変わらない。
- 画像TAD
  - マスクデータ定義で不具合があるため、塗りつぶしのマスクパターン描画がおかしい。
  - 画像セグメントの色が微妙におかしい（白のはずが若干灰色、青みがかっている）
  - 線種定義セグメントの線種の再現度が低い

## 未対応セグメント

- 共通
  - 機能付箋セグメント
  - 設定付箋セグメント（Unofficial TAD Guide Bookにて非推奨）
- 文章TAD
  - 用紙指定付箋（xmlTAD側のみ対応）
  - マージン指定付箋（xmlTAD側のみ対応）
  - コラム指定付箋
  - 用紙オーバーレイ定義付箋
  - 用紙オーバーレイ指定付箋
  - 枠あけ指定付箋
  - ページ番号指定付箋
  - 条件改ページ指定付箋
  - 充填行指定付箋
  - 行間隔指定付箋（のベースライン対応）
  - 行揃え指定付箋（のうち、両端揃え、均等揃え）
  - タブ書式指定付箋
  - フィールド書式指定付箋
  - 文字方向指定付箋
  - フォント指定付箋（簡易的に対応）
  - 文字拡大/縮小指定付箋
  - 文字間隔指定付箋（のうちカーニング）
  - 文字回転指定付箋（Unofficial TAD Guide Bookにて非推奨）
  - 文字基準位置移動付箋（Unofficial TAD Guide Bookにて非推奨）
  - 充填文字指定付箋
  - 文字罫線指定付箋（Unofficial TAD Guide Bookにて非推奨）
  - 結合開始指定付箋
  - 結合終了指定付箋
  - 文字割付開始指定付箋
  - 文字割付終了指定付箋
  - 添字開始指定付箋（xmlTAD側のみ対応）
  - 添字終了指定付箋（xmlTAD側のみ対応）
  - 行頭禁則指定付箋（一部不具合）
  - 行末禁則指定付箋（一部不具合）
  - 変数参照指定付箋（Unofficial TAD Guide Bookにて非推奨）
  - 文章アプリケーション指定付箋
- 図形TAD
  - 図形要素セグメント全般で直接描画（0:STORE）以外は非対応（Unofficial TAD Guide Bookにて0:STORE以外は非推奨）
  - マーカー列セグメント
  - 任意図形セグメント
  - カラーマップ定義セグメント
  - 線種定義セグメント（の長さが正しくない）
  - マーカー定義セグメント
  - グループ開始セグメント
  - グループ終了セグメント
  - マクロ定義開始セグメント（Unofficial TAD Guide Bookによると実装例なし）
  - マクロ定義終了セグメント（Unofficial TAD Guide Bookによると実装例なし）
  - マクロ参照セグメント
  - 図形要素装飾セグメント
  - 座標変換セグメント
  - 用紙指定付箋
  - マージン指定付箋
  - 用紙オーバーレイ定義付箋
  - 用紙オーバーレイ指定付箋
  - ページ番号指定付箋
  - 図形アプリケーション指定付箋

## サンプル文章について

BTRON Clubで報告した内容を共有しています。

TADjs by satromi is licensed under the Apache License, Version2.0
