# BTRON Desktop Environment

ブラウザ上でBTRONの見た目と操作性を再現したデスクトップ環境です。TAD.jsと統合してTADファイルの表示も可能です。

## 特徴

- **BTRON風UI**: BTRON OSの特徴的なウインドウシステム、メニュー、指型カーソルを再現
- **ウインドウ管理**: ドラッグ移動、リサイズ、前後関係管理
- **階層メニュー**: 右クリックによるコンテキストメニューとキーボードショートカット
- **TAD統合**: TAD.jsを使用したTADファイルの表示
- **ドラッグ&ドロップ**: TADファイルの簡単な読み込み

## ファイル構成

```
btron-desktop.html      - メインHTMLファイル  
btron-desktop.css       - BTRON風スタイル
btron-desktop.js        - デスクトップ環境の実装
tad.js                  - TADファイル処理
encoding.min.js         - 文字エンコーディング処理
```

## 使用方法

### 1. 基本起動
```bash
# HTTPサーバーで起動（必須）
python -m http.server 8000
# または
npx http-server
```

ブラウザで `http://localhost:8000/btron-desktop.html` を開く

### 2. TADファイルの読み込み

- **ドラッグ&ドロップ**: TADファイルをファイル一覧エリアにドラッグ
- **ファイル選択**: デスクトップで右クリック → 「ファイルを開く...」

### 3. 基本操作

#### ウインドウ操作
- **移動**: タイトルバーをドラッグ
- **リサイズ**: ウインドウ端のハンドルをドラッグ  
- **閉じる**: タイトルバーの「×」ボタンまたは右クリック → 「閉じる」
- **アクティブ化**: ウインドウをクリック

#### ファイル操作
- **開く**: ファイルアイコンをダブルクリック、またはEnterキー
- **選択**: ファイルアイコンをクリック
- **プロパティ**: 右クリック → 「プロパティ」またはAlt+Enter

#### メニュー操作
- **コンテキストメニュー**: 右クリックで表示
- **メニュー項目選択**: クリックまたはキーボードショートカット

### 4. キーボードショートカット

| キー | 動作 |
|------|------|
| `Ctrl+W` | アクティブウインドウを閉じる |
| `Enter` | 選択ファイルを開く |
| `Alt+Enter` | 選択ファイルのプロパティ表示 |
| `Escape` | メニューを閉じる |

### 5. メニュー機能

#### ファイルアイコンのメニュー
- 開く
- プロパティ

#### ウインドウのメニュー
- 閉じる  
- 最小化（未実装）
- プロパティ

#### デスクトップのメニュー
- ファイルを開く...
- ウインドウ一覧
- デスクトップをクリア
- システム情報

## UI要素

### ステータスバー
- 左側: システムメッセージ
- 右側: 現在日時（YYYY/MM/DD HH:MM形式）

### ウインドウ構成  
- **タイトルバー**: タイトル表示、ドラッグ移動、閉じるボタン
- **コンテンツエリア**: TADキャンバスまたは情報表示
- **リサイズハンドル**: 8方向のリサイズ対応

### カーソル
- BTRON風の指型カーソル（SVG形式）

## TAD.js統合

TAD.jsと連携してTADファイルを表示：
- 自動的にキャンバスサイズを設定（800x600）
- エラーハンドリングとフォールバック表示  
- 複数TADファイルの同時表示対応

## 技術的詳細

### 実装言語
- HTML5 / CSS3 / ES6 JavaScript

### 対応ブラウザ  
- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

### 外部依存
- TAD.js（TADファイル処理）
- encoding.min.js（文字エンコード処理）

## カスタマイズ

### CSS変数
```css
:root {
    --window-border-color: #808080;     /* ウインドウ枠色 */
    --window-shadow-color: #404040;     /* ウインドウ影色 */
    --window-titlebar-active: #c0c0c0;  /* アクティブタイトルバー */
    --window-background: #f0f0f0;       /* ウインドウ背景 */
    --status-bar-color: #d4d0c8;        /* ステータスバー色 */
}
```

### デスクトップ背景色
```css
body {
    background: #008080; /* BTRONの標準デスクトップ色 */
}
```

## 既知の制限

1. **ウインドウ最小化機能**: 未実装
2. **マルチモニタ対応**: 単一画面のみ
3. **ファイルシステム**: ブラウザのFileAPI制限内
4. **印刷機能**: 未対応

## ライセンス

Apache License, Version2.0

## 開発者向け情報

### BTRONDesktopクラス
メインの制御クラス：
```javascript
const desktop = new BTRONDesktop();
```

### 主要メソッド
- `createWindow(title, content, options)` - ウインドウ作成
- `openTADFile(file)` - TADファイル表示
- `showContextMenu(x, y, target)` - メニュー表示
- `setActiveWindow(windowId)` - アクティブウインドウ設定

### イベントハンドリング
- ドラッグ&ドロップ
- キーボードショートカット  
- ウインドウ操作（移動、リサイズ）
- メニュー操作

## トラブルシューティング

### TADファイルが表示されない
1. TAD.jsが正しく読み込まれているか確認
2. ブラウザの開発者ツールでエラーを確認
3. HTTPサーバー経由でアクセスしているか確認

### ドラッグ&ドロップが機能しない  
1. HTTPSまたはlocalhostでアクセスしているか確認
2. ファイル形式が対応しているか確認（.tad, .bpk）

### レスポンシブ表示の問題
1. ブラウザのズーム設定を100%に設定
2. 画面解像度が800x600以上であることを確認