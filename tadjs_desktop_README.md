# TADjs Desktop - インストールと起動方法（配布版）

Ver0.32

## 初回起動時の注意

### Windows Defender SmartScreenの警告について

このアプリケーションはコード署名証明書で署名されていないため、
初回起動時にWindows Defender SmartScreenの警告が表示されます。

**これは正常な動作です。以下の手順で起動してください:**

1. ZIPファイルを展開します
2. `tadjs_desktop.exe` をダブルクリックします
3. 「Windows によって PC が保護されました」という警告が表示されます
4. **「詳細情報」をクリック**します
5. 画面下部に表示される**「実行」ボタンをクリック**します

### ウイルス対策ソフトについて

一部のウイルス対策ソフトが未署名のアプリケーションを
ブロックする場合があります。その場合は、以下の対処を行ってください:

- ウイルス対策ソフトの例外リストに `tadjs_desktop.exe` を追加
- 信頼できる開発元として登録

## 動作環境

- Windows 10 / 11 (64bit)
- 必要なディスク容量: 約250MB

## 使い方

- tadjs_desktop.zipをCドライブ（推奨）のtadjs-desktopフォルダーに解凍します
  - 作成したファイルは全てこのフォルダーに配置されます
- `tadjs_desktop.exe` を起動します
- ウインドウ外で右クリックメニュー「小物」の「ファイルを開く」からTADファイル（.tad, .xtad）やBPKファイル（.bpk）を開けます
- 右クリックメニューから各種プラグインを利用できます
- デフォルト起動で原紙箱があるので、原紙を既存のウインドウにドラッグすると新しい実身が生成されます

## ファイルの管理について

TADjs Desktopは、BTRONの「仮身」「実身」という独特のファイル管理概念を採用しており、xmlTAD（仮称）として文章TAD/図形TADを扱います。
xmlTADは最低3つのファイルから構成されます。

### 実身（Real Object）

- **実体ファイル**: 実際のデータを持つxmlTADファイル
- **一意のID**: UUIDv7で管理される固有識別子
- **参照カウント**: その実身を参照している仮身の数を記録
- **ファイル構成**:
  - `.json`: メタデータ（名前、プラグインID、参照カウントなど）
  - `_0.xtad`: 実際のデータ（TAD形式）
  - `.ico`: アイコン画像

### 仮身（Virtual Object）

- **参照オブジェクト**: 実身へのリンク（参照）
- **複数配置可能**: 同じ実身に対して複数の仮身を作成可能
- **属性情報**: 表示位置、サイズ、表示設定などを保持

### 仮身と実身の関係

```
原紙箱（実身）
  └─ ファイルA.json
  └─ ファイルA_0.xtad
  └─ ファイルA.ico

文書1（実身）
  └─ <link>タグで「ファイルA」を参照（仮身1）

文書2（実身）
  └─ <link>タグで「ファイルA」を参照（仮身2）
```

上記の例では、「ファイルA」の実身に対して、2つの仮身が存在します。

- どちらの仮身からも同じ「ファイルA」の内容にアクセスできます
- 「ファイルA」の内容を更新すると、両方の仮身に反映されます
- 「ファイルA」の参照カウントは2になります

## アンインストール

フォルダーごと削除してください。レジストリへの登録は行いません。

## トラブルシューティング（配布版）

### 起動できない場合

- Windows Defenderやウイルス対策ソフトの設定を確認してください
- 管理者権限で実行してみてください
- フォルダー内のすべてのファイルが揃っているか確認してください

### ファイルが開けない場合

- ファイルの拡張子が .tad, .xtad, .bpk であることを確認してください
- ファイルが破損していないか確認してください

## 問い合わせ

不明点がある場合は [連絡先情報] までご連絡ください。

---

# 各アプリの説明

## 既存データ起動の使い方

既存データ起動は、Excel、Word、PDFなど、Windowsにインストールされている既存のアプリケーションでファイルを開くための機能です。

### 既存データの配置方法

既存データファイルは、**実身IDと同じ名前**で配置する必要があります。

**ファイル名の形式**: `実身ID.拡張子`

例：

- Excelファイル: `019a68ec-8c44-78e1-8a9d-f72bad88c9ef.xlsx`
- Wordファイル: `019a68ec-8c44-78e1-8a9d-f72bad88c9ef.docx`
- PDFファイル: `019a68ec-8c44-78e1-8a9d-f72bad88c9ef.pdf`

### 手順

#### 1. 実身IDの確認

既存データ起動実身の実身IDを確認します：

- 実身のファイルを確認: `019a68ec-8c44-78e1-8a9d-f72bad88c9ef.json`
- または、実身のプロパティから実身IDをコピー

#### 2. 拡張子の指定

既存データ起動実身を「基本文章編集」で開き、ファイルの拡張子を記載します：

```
xlsx
```

または

```
docx
```

または

```
pdf
```

**注意**: 拡張子のみを記載してください（`.`は不要）

#### 3. 既存データファイルの配置

開きたいファイルを、`tadjs_desktop.exe`と同じフォルダーに配置し、以下の形式にリネームします：

```
実身ID.拡張子
```

例：
```
019a68ec-8c44-78e1-8a9d-f72bad88c9ef.xlsx
```

#### 4. 起動

既存データ起動実身をダブルクリックすると、指定された拡張子のファイルがWindowsのデフォルトアプリケーションで開きます。

### リネーム方法の例

元のファイル名が `売上報告.xlsx` の場合：

1. 実身IDを確認: `019a68ec-8c44-78e1-8a9d-f72bad88c9ef`
2. ファイルをリネーム: `売上報告.xlsx` → `019a68ec-8c44-78e1-8a9d-f72bad88c9ef.xlsx`
3. `tadjs_desktop.exe`と同じフォルダーに配置

### トラブルシューティング

**ファイルが開かない場合**:

- ファイル名が `実身ID.拡張子` の形式になっているか確認
- 拡張子が基本文章編集で正しく指定されているか確認（`.`なし）
- ファイルが `tadjs_desktop.exe` と同じフォルダーにあるか確認
- その拡張子を開けるアプリケーションがインストールされているか確認

## URL仮身の使い方

URL仮身は、実身に記載したURLを規定のブラウザで開くための機能です。

### 手順

#### 1. URL指定

URL仮身を基本文章編集プラグインで開いて、URLを記載します。

#### 2. 起動

URL仮身をダブルクリックすると、指定されたURLがデフォルトブラウザで開きます。

# 開発者向け情報

TADjs DesktopはElectronベースのデスクトップアプリケーションです。BTRONの見た目と操作性を再現し、TADファイルの表示・編集が可能です。

## 特徴

- **BTRON UI**: BTRON OSの特徴的なウインドウシステム、メニュー、指型カーソルを再現
- **ウインドウ管理**: ドラッグ移動、リサイズ、前後関係管理
- **階層メニュー**: 右クリックによるコンテキストメニューとキーボードショートカット
- **TAD統合**: TADファイル（.tad, .bpk）およびxmlTADファイル（.xtad）の表示・編集
- **プラグインシステム**: 拡張可能なプラグインアーキテクチャ
- **実身/仮身システム**: BTRONのハイパーリンク構造を再現

## ディレクトリ構成

```
btron-desktop/
├── electron/              # Electronメインプロセス
│   ├── main.js           # アプリケーションエントリーポイント
│   └── preload.js        # プリロードスクリプト
├── plugins/              # プラグインディレクトリ（約20種）
│   ├── basic-text-editor/   # 基本文章編集
│   ├── basic-figure-editor/ # 基本図形編集
│   ├── basic-calc-editor/   # 基本表計算
│   ├── virtual-object-list/ # 仮身一覧
│   ├── unpack-file/         # TAD→xtad変換
│   └── ...
├── js/                   # 共通ユーティリティ
│   ├── real-object-system.js   # 実身管理
│   ├── virtual-object-renderer.js  # 仮身描画
│   ├── message-bus.js    # プラグイン間通信
│   └── plugin-base.js    # プラグイン基底クラス
├── tadjs-desktop.js      # メインレンダラープロセス
├── tad.js               # TADパーサー/レンダラー
├── lh5.js               # LH5アーカイブ解凍
└── encoding.js          # TRON文字コード変換
```

## 開発用コマンド

```bash
# 開発モードで起動
npm run start

# 開発モード (--devフラグ付き)
npm run dev

# パッケージング (実行ファイル生成)
npm run package
```

## プラグインシステム

プラグインはiframe内で動作するHTML/JavaScriptアプリケーションです。

### プラグインタイプ

| タイプ | 説明 | 例 |
|--------|------|------|
| `base` | 原紙プラグイン（原紙箱に表示） | basic-text-editor, basic-figure-editor |
| `accessory` | 小物プラグイン | system-config, file-import |
| `utility` | ユーティリティ | trash-real-objects |
| `genko` | 表示専用 | tadjs-view |

### プラグイン開発

1. `plugins/your-plugin/` ディレクトリを作成
2. `plugin.json` でメタデータ定義
3. `index.html` をエントリーポイントとして作成
4. `app.js` で `PluginBase` クラスを継承して実装

詳細は [docs/PLUGIN_DEVELOPMENT_GUIDE.md](docs/PLUGIN_DEVELOPMENT_GUIDE.md) を参照。

## 技術的詳細

### 実装技術

- **フレームワーク**: Electron
- **言語**: HTML5 / CSS3 / ES6 JavaScript
- **データ形式**: TAD（BTRON標準）、xmlTAD（XML形式）

### 主要コンポーネント

- **tad.js**: TADファイルのパース・レンダリング
- **lh5.js**: BPK書庫（LH5圧縮）の解凍
- **encoding.js**: TRON文字コードの変換
- **MessageBus**: プラグイン間・ウィンドウ間通信

## 既知の制限

1. **マルチモニタ対応**: 単一画面のみ
2. **印刷機能**: 未対応
3. **TAD完全互換**: 一部の付箋セグメントは未対応

## ライセンス

Apache License, Version2.0

## 連絡先情報

satromi
satromi@gmail.com