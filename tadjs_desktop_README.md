# TADjs Desktop - インストールと起動方法（配布版）

Ver0.13


## 初回起動時の注意

### Windows Defender SmartScreenの警告について

このアプリケーションはコード署名証明書で署名されていないため、
初回起動時にWindows Defender SmartScreenの警告が表示されます。

**これは正常な動作です。以下の手順で起動してください:**

1. ZIPファイルを展開します
2. `tadjs_desktop.exe` をダブルクリックします
3. 「Windows によって PC が保護されました」という警告が表示されます
4. **「詳細情報」をクリック**します
5. 画面下部に表示される**「実行」ボタンをクリック**します

### ウイルス対策ソフトについて

一部のウイルス対策ソフトが未署名のアプリケーションを
ブロックする場合があります。その場合は、以下の対処を行ってください:

- ウイルス対策ソフトの例外リストに `tadjs_desktop.exe` を追加
- 信頼できる開発元として登録

## 動作環境

- Windows 10 / 11 (64bit)
- 必要なディスク容量: 約250MB

## 使い方

- tadjs_desktop.zipをCドライブ（推奨）のtadjs-desktopフォルダーに解凍します
  - 作成したファイルは全てこのフォルダーに配置されます
- `tadjs_desktop.exe` を起動します
- ウインドウ外で右クリックメニューの「ファイルを開く」からTADファイル（.tad, .xtad）やBPKファイル（.bpk）をを開けます
- 右クリックメニューから各種プラグインを利用できます
- デフォルト起動で原紙箱があるので、原紙を既存のウインドウにドラッグすると新しい実身が生成されます


## ファイルの管理について

TADjs Desktopは、BTRONの「仮身」「実身」という独特のファイル管理概念を採用しており、xmlTAD（仮称）として文章TAD/図形TADを扱います。
xmlTADは最低3つのファイルから構成されます。


### 実身（Real Object）
- **実体ファイル**: 実際のデータを持つxmlTADファイル
- **一意のID**: UUIDv7で管理される固有識別子
- **参照カウント**: その実身を参照している仮身の数を記録
- **ファイル構成**:
  - `.json`: メタデータ（名前、プラグインID、参照カウントなど）
  - `_0.xtad`: 実際のデータ（TAD形式）
  - `.ico`: アイコン画像

### 仮身（Virtual Object）
- **参照オブジェクト**: 実身へのリンク（参照）
- **複数配置可能**: 同じ実身に対して複数の仮身を作成可能
- **属性情報**: 表示位置、サイズ、表示設定などを保持

### 仮身と実身の関係
```
原紙箱（実身）
  └─ ファイルA.json
  └─ ファイルA_0.xtad
  └─ ファイルA.ico

文書1（実身）
  └─ <link>タグで「ファイルA」を参照（仮身1）

文書2（実身）
  └─ <link>タグで「ファイルA」を参照（仮身2）
```

上記の例では、「ファイルA」の実身に対して、2つの仮身が存在します。
- どちらの仮身からも同じ「ファイルA」の内容にアクセスできます
- 「ファイルA」の内容を更新すると、両方の仮身に反映されます
- 「ファイルA」の参照カウントは2になります

## アンインストール

フォルダーごと削除してください。レジストリへの登録は行いません。

## トラブルシューティング（配布版）

### 起動できない場合

- Windows Defenderやウイルス対策ソフトの設定を確認してください
- 管理者権限で実行してみてください
- フォルダー内のすべてのファイルが揃っているか確認してください

### ファイルが開けない場合

- ファイルの拡張子が .tad, .xtad, .bpk であることを確認してください
- ファイルが破損していないか確認してください

## 問い合わせ

不明点がある場合は [連絡先情報] までご連絡ください。

---

# 各アプリの説明

## 既存データ起動の使い方

既存データ起動は、Excel、Word、PDFなど、Windowsにインストールされている既存のアプリケーションでファイルを開くための機能です。

### 既存データの配置方法

既存データファイルは、**実身IDと同じ名前**で配置する必要があります。

**ファイル名の形式**: `実身ID.拡張子`

例：

- Excelファイル: `019a68ec-8c44-78e1-8a9d-f72bad88c9ef.xlsx`
- Wordファイル: `019a68ec-8c44-78e1-8a9d-f72bad88c9ef.docx`
- PDFファイル: `019a68ec-8c44-78e1-8a9d-f72bad88c9ef.pdf`

### 手順

#### 1. 実身IDの確認

既存データ起動実身の実身IDを確認します：

- 実身のファイルを確認: `019a68ec-8c44-78e1-8a9d-f72bad88c9ef.json`
- または、実身のプロパティから実身IDをコピー

#### 2. 拡張子の指定

既存データ起動実身を「基本文章編集」で開き、ファイルの拡張子を記載します：

```
xlsx
```

または

```
docx
```

または

```
pdf
```

**注意**: 拡張子のみを記載してください（`.`は不要）

#### 3. 既存データファイルの配置

開きたいファイルを、`tadjs_desktop.exe`と同じフォルダーに配置し、以下の形式にリネームします：

```
実身ID.拡張子
```

例：
```
019a68ec-8c44-78e1-8a9d-f72bad88c9ef.xlsx
```

#### 4. 起動

既存データ起動実身をダブルクリックすると、指定された拡張子のファイルがWindowsのデフォルトアプリケーションで開きます。

### リネーム方法の例

元のファイル名が `売上報告.xlsx` の場合：

1. 実身IDを確認: `019a68ec-8c44-78e1-8a9d-f72bad88c9ef`
2. ファイルをリネーム: `売上報告.xlsx` → `019a68ec-8c44-78e1-8a9d-f72bad88c9ef.xlsx`
3. `tadjs_desktop.exe`と同じフォルダーに配置

### トラブルシューティング

**ファイルが開かない場合**:
- ファイル名が `実身ID.拡張子` の形式になっているか確認
- 拡張子が基本文章編集で正しく指定されているか確認（`.`なし）
- ファイルが `tadjs_desktop.exe` と同じフォルダーにあるか確認
- その拡張子を開けるアプリケーションがインストールされているか確認

## URL仮身の使い方

URL仮身は、実身に記載したURLを規定のブラウザで開くための機能です。

### 手順

#### 1. URL指定

URL仮身を基本文章編集プラグインで開いて、URLを記載します。

#### 2. 起動

URL仮身をダブルクリックすると、指定されたURLがデフォルトブラウザで開きます。


# BTRON Desktop Environment（開発者向け情報）

ブラウザ上でBTRONの見た目と操作性を再現したデスクトップ環境です。TAD.jsと統合してTADファイルの表示も可能です。

## 特徴

- **BTRON UI**: BTRON OSの特徴的なウインドウシステム、メニュー、指型カーソルを再現
- **ウインドウ管理**: ドラッグ移動、リサイズ、前後関係管理
- **階層メニュー**: 右クリックによるコンテキストメニューとキーボードショートカット
- **TAD統合**: TAD.jsを使用したTADファイルの表示
- **ドラッグ&ドロップ**: TADファイルの簡単な読み込み

## ファイル構成

```
btron-desktop.html      - メインHTMLファイル  
btron-desktop.css       - BTRON風スタイル
btron-desktop.js        - デスクトップ環境の実装
tad.js                  - TADファイル処理
encoding.min.js         - 文字エンコーディング処理
```

## 使用方法

### 1. 基本起動



### 2. TADファイルの読み込み

- **ドラッグ&ドロップ**: TADファイルをファイル一覧エリアにドラッグ
- **ファイル選択**: デスクトップで右クリック → 「ファイルを開く...」

### 3. 基本操作

#### ウインドウ操作
- **移動**: タイトルバーをドラッグ
- **リサイズ**: ウインドウ端のハンドルをドラッグ  
- **閉じる**: タイトルバーの「×」ボタンまたは右クリック → 「閉じる」
- **アクティブ化**: ウインドウをクリック

#### ファイル操作
- **開く**: ファイルアイコンをダブルクリック、またはEnterキー
- **選択**: ファイルアイコンをクリック
- **プロパティ**: 右クリック → 「プロパティ」またはAlt+Enter

#### メニュー操作
- **コンテキストメニュー**: 右クリックで表示
- **メニュー項目選択**: クリックまたはキーボードショートカット

### 4. キーボードショートカット

| キー | 動作 |
|------|------|
| `Ctrl+W` | アクティブウインドウを閉じる |
| `Enter` | 選択ファイルを開く |
| `Alt+Enter` | 選択ファイルのプロパティ表示 |
| `Escape` | メニューを閉じる |

### 5. メニュー機能

#### ファイルアイコンのメニュー
- 開く
- プロパティ

#### ウインドウのメニュー
- 閉じる  
- 最小化（未実装）
- プロパティ

#### デスクトップのメニュー
- ファイルを開く... : 既存の書庫形式のファイル（BPK/bpk）を仮身一覧ウインドウに取り込みます
- ウインドウ一覧
- デスクトップをクリア
- システム情報

## UI要素

### ステータスバー
- 左側: システムメッセージ
- 右側: 現在日時（YYYY/MM/DD HH:MM形式）

### ウインドウ構成  
- **タイトルバー**: タイトル表示、ドラッグ移動、閉じるボタン
- **コンテンツエリア**: TADキャンバスまたは情報表示
- **リサイズハンドル**: 8方向のリサイズ対応

### カーソル
- BTRON風の指型カーソル（SVG形式）

## TAD.js統合

TAD.jsと連携してTADファイルを表示：
- 自動的にキャンバスサイズを設定（800x600）
- エラーハンドリングとフォールバック表示  
- 複数TADファイルの同時表示対応

## 技術的詳細

### 実装言語
- HTML5 / CSS3 / ES6 JavaScript

### 対応ブラウザ  
- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

### 外部依存
- TAD.js（TADファイル処理）
- encoding.min.js（文字エンコード処理）

## カスタマイズ

### CSS変数
```css
:root {
    --window-border-color: #808080;     /* ウインドウ枠色 */
    --window-shadow-color: #404040;     /* ウインドウ影色 */
    --window-titlebar-active: #c0c0c0;  /* アクティブタイトルバー */
    --window-background: #f0f0f0;       /* ウインドウ背景 */
    --status-bar-color: #d4d0c8;        /* ステータスバー色 */
}
```

### デスクトップ背景色
```css
body {
    background: #008080; /* BTRONの標準デスクトップ色 */
}
```

## 既知の制限

1. **ウインドウ最小化機能**: 未実装
2. **マルチモニタ対応**: 単一画面のみ
3. **ファイルシステム**: 単一フォルダーに保存
4. **印刷機能**: 未対応

## ライセンス

Apache License, Version2.0

## 開発者向け情報

### BTRONDesktopクラス
メインの制御クラス：
```javascript
const desktop = new BTRONDesktop();
```

### 主要メソッド
- `createWindow(title, content, options)` - ウインドウ作成
- `openTADFile(file)` - TADファイル表示
- `showContextMenu(x, y, target)` - メニュー表示
- `setActiveWindow(windowId)` - アクティブウインドウ設定

### イベントハンドリング
- ドラッグ&ドロップ
- キーボードショートカット  
- ウインドウ操作（移動、リサイズ）
- メニュー操作

## トラブルシューティング

### TADファイルが表示されない
1. TAD.jsが正しく読み込まれているか確認
2. ブラウザの開発者ツールでエラーを確認
3. HTTPサーバー経由でアクセスしているか確認

### ドラッグ&ドロップが機能しない  
1. HTTPSまたはlocalhostでアクセスしているか確認
2. ファイル形式が対応しているか確認（.tad, .bpk）

### レスポンシブ表示の問題
1. ブラウザのズーム設定を100%に設定
2. 画面解像度が800x600以上であることを確認

## 連絡先情報

satromi
satromi@gmail.com